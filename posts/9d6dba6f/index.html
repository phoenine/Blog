<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>世上最好的共享内存 | 因受</title><meta name="author" content="Phoenine"><meta name="copyright" content="Phoenine"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="1.  宋宝华：世上最好的共享内存共享单车、共享充电宝、共享雨伞，世间的共享有千万种，而我独爱共享内存。 早期的共享内存，着重于强调把同一片内存，map到多个进程的虚拟地址空间（在相应进程找到一个VMA区域），以便于CPU可以在各个进程访问到这片内存。  现阶段广泛应用于多媒体、Graphics领域的共享内存方式，某种意义上不再强调映射到进程虚拟地址空间的概念（那无非是为了让CPU访问），而更强调">
<meta property="og:type" content="article">
<meta property="og:title" content="世上最好的共享内存">
<meta property="og:url" content="https://blog.phoenine.top/posts/9d6dba6f/index.html">
<meta property="og:site_name" content="因受">
<meta property="og:description" content="1.  宋宝华：世上最好的共享内存共享单车、共享充电宝、共享雨伞，世间的共享有千万种，而我独爱共享内存。 早期的共享内存，着重于强调把同一片内存，map到多个进程的虚拟地址空间（在相应进程找到一个VMA区域），以便于CPU可以在各个进程访问到这片内存。  现阶段广泛应用于多媒体、Graphics领域的共享内存方式，某种意义上不再强调映射到进程虚拟地址空间的概念（那无非是为了让CPU访问），而更强调">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog.phoenine.top/img/cover/shark.png">
<meta property="article:published_time" content="2021-04-22T03:00:56.000Z">
<meta property="article:modified_time" content="2025-10-23T07:02:34.434Z">
<meta property="article:author" content="Phoenine">
<meta property="article:tag" content="因受 苦行">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.phoenine.top/img/cover/shark.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "世上最好的共享内存",
  "url": "https://blog.phoenine.top/posts/9d6dba6f/",
  "image": "https://blog.phoenine.top/img/cover/shark.png",
  "datePublished": "2021-04-22T03:00:56.000Z",
  "dateModified": "2025-10-23T07:02:34.434Z",
  "author": [
    {
      "@type": "Person",
      "name": "Phoenine",
      "url": "https://blog.phoenine.top"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://blog.phoenine.top/posts/9d6dba6f/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css?v=5.5.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: {"appId":"Z7A3XW4R2I","apiKey":"12db1ad54372045549ef465881c17e743","indexName":"blog","hitsPerPage":6,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，耗时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '世上最好的共享内存',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/my-footer.css"><link rel="stylesheet" href="/css/my-callout.css"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-butterfly-swiper@1.0.12/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-butterfly-swiper@1.0.12/lib/swiperstyle.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-color: #E2F2F6;"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">69</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">22</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">19</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-archive"></i><span> 归档</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-timeline"></i><span> 时间轴</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-list"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-project-diagram"></i><span> 项目</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://github.com/phoenine/amazon-scraper"><i class="fa-fw fas fa-spider"></i><span> amazon-scraper</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-coffee"></i><span> 生活</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/artitalk/"><i class="fa-fw fas fa-comments"></i><span> 说说</span></a></li><li><a class="site-page child" href="/photos/"><i class="fa-fw fas fa-video"></i><span> 相册</span></a></li><li><a class="site-page child" href="/message/"><i class="fa-fw fas fa-mail-bulk"></i><span> 留言</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">因受</span></a><a class="nav-page-title" href="/"><span class="site-name">世上最好的共享内存</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-archive"></i><span> 归档</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-timeline"></i><span> 时间轴</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-list"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-project-diagram"></i><span> 项目</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://github.com/phoenine/amazon-scraper"><i class="fa-fw fas fa-spider"></i><span> amazon-scraper</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-coffee"></i><span> 生活</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/artitalk/"><i class="fa-fw fas fa-comments"></i><span> 说说</span></a></li><li><a class="site-page child" href="/photos/"><i class="fa-fw fas fa-video"></i><span> 相册</span></a></li><li><a class="site-page child" href="/message/"><i class="fa-fw fas fa-mail-bulk"></i><span> 留言</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">世上最好的共享内存</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-04-22T03:00:56.000Z" title="发表于 2021-04-22 11:00:56">2021-04-22</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-10-23T07:02:34.434Z" title="更新于 2025-10-23 15:02:34">2025-10-23</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">操作系统</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux-Basic/">Linux Basic</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>16分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="container post-content" id="article-container"><h2 id="1-宋宝华：世上最好的共享内存"><a href="#1-宋宝华：世上最好的共享内存" class="headerlink" title="1.  宋宝华：世上最好的共享内存"></a>1.  宋宝华：世上最好的共享内存</h2><p>共享单车、共享充电宝、共享雨伞，世间的共享有千万种，而我独爱共享内存。</p>
<p>早期的共享内存，着重于强调把同一片内存，map到多个进程的虚拟地址空间（在相应进程找到一个VMA区域），以便于CPU可以在各个进程访问到这片内存。</p>
<p><img src="/./assets/%E4%B8%96%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/format,png.png" alt="img"></p>
<p>现阶段广泛应用于多媒体、Graphics领域的共享内存方式，某种意义上不再强调映射到进程虚拟地址空间的概念（那无非是为了让CPU访问），而更强调以某种“句柄”的形式，让大家知道某一片视频、图形图像数据的存在并可以借助此“句柄”来跨进程引用这片内存，让视频encoder、decoder、GPU等可以跨进程访问内存。所以不同进程用的加速硬件其实是不同的，他们更在乎的是可以通过一个handle拿到这片内存，而不再特别在乎CPU访问它的虚拟地址（当然仍然可以映射到进程的虚拟地址空间供CPU访问）。</p>
<p><img src="/./assets/%E4%B8%96%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/format,png-20210408215011301.png" alt="img"></p>
<p>只要内存的拷贝(memcpy)仍然是一个占据内存带宽、CPU利用率的消耗大户存在，共享内存作为Linux进程间通信、计算机系统里各个不同硬件组件通信的最高效方法，都将持续繁荣。关于内存拷贝会大多程度地占据CPU利用率，这个可以最简单地尝试拷贝1080P，帧率每秒60的电影画面，我保证你的系统的CPU，蛋会疼地不行。</p>
<p>我早就想系统地写一篇综述Linux里面各种共享内存方式的文章了，但是一直被带娃这个事业牵绊，今日我决定顶着娃娃们的山呼海啸，也要写一篇文章不吐不快。</p>
<p>共享内存的方式有很多种，目前主流的方式仍然有：</p>
<p><img src="/./assets/%E4%B8%96%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/format,png-20210408215025345.png" alt="img"></p>
<p>共享内存的方式</p>
<p>1.基于传统SYS V的共享内存；</p>
<p>2.基于POSIX mmap文件映射实现共享内存；</p>
<p>3.通过memfd_create()和fd跨进程共享实现共享内存；</p>
<p>4.多媒体、图形领域广泛使用的基于dma-buf的共享内存。</p>
<p>共享内存</p>
<p>SYS V共享内存</p>
<p>历史悠久、年代久远、API怪异，对应内核代码linux/ipc/shm.c，当你编译内核的时候不选择CONFIG_SYSVIPC，则不再具备此能力。</p>
<p>你在Linux敲ipcs命令看到的share memory就是这种共享内存：</p>
<p><img src="/./assets/%E4%B8%96%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/format,png.jpeg" alt="img"></p>
<p>下面写一个最简单的程序来看共享内存的写端sw.c：</p>
<p><img src="/./assets/%E4%B8%96%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/format,png-20210408215041892.png" alt="img"></p>
<p>以及共享内存的读端sr.c：</p>
<p><img src="/./assets/%E4%B8%96%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/format,png-20210408215049945.png" alt="img"></p>
<p>编译和准备运行：</p>
<p><img src="/./assets/%E4%B8%96%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/format,png-20210408215056849.png" alt="img"></p>
<p>在此之前我们看一下系统的free:</p>
<p><img src="/./assets/%E4%B8%96%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/format,png-20210408215103876.png" alt="img"></p>
<p>下面运行sw和sr：</p>
<p><img src="/./assets/%E4%B8%96%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/format,png-20210408215112625.png" alt="img"></p>
<p>我们发现sr打印出来的和sw写进去的是一致的。这个时候我们再看下free：</p>
<p><img src="/./assets/%E4%B8%96%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/format,png-20210408215118480.png" alt="img"></p>
<p>可以看到used显著增大了（711632 -&gt; 715908）, shared显著地增大了（2264 -&gt; 6360），而cached这一列也显著地增大326604-&gt;330716。</p>
<p>我们都知道cached这一列统计的是file-backed的文件的page cache的大小。理论上，共享内存属于匿名页，但是由于这里面有个非常特殊的tmpfs（/dev/shm指向/run/shm,/run/shm则mount为tmpfs）：</p>
<p><img src="/./assets/%E4%B8%96%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/format,png-20210408215127651.png" alt="img"></p>
<p>所以可以看出tmpfs的东西其实真的是有点含混：我们可以理解它为file-backed的匿名页（anonymous page），有点类似女声中的周深。前面我们反复强调，匿名页是没有文件背景的，这样当进行内存交换的时候，是与swap分区交换。磁盘文件系统里面的东西在内存的副本是file-backed的页面，所以不存在与swap分区交换的问题。但是tmpfs里面的东西，真的是在统计意义上统计到page cache了，但是它并没有真实的磁盘背景，这又和你访问磁盘文件系统里面的文件产生的page cache有本质的区别。所以，它是真地有那么一点misc的感觉，凡事都没有绝对，唯有变化本身是不变的。</p>
<p>也可以通过ipcs找到新创建的SYS V共享内存：</p>
<p><img src="/./assets/%E4%B8%96%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/format,png-20210408215135031.jpeg" alt="img"></p>
<p>POSIX共享内存</p>
<p>我对POSIX shm_open()、mmap () API系列的共享内存的喜爱，远远超过SYS V 100倍。原谅我就是一个懒惰的人，我就是讨厌ftok、shmget、shmat、shmdt这样的API。</p>
<p>上面的程序如果用POSIX的写法，可以简化成写端psw.c：</p>
<p><img src="/./assets/%E4%B8%96%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/format,png-20210408215142219.png" alt="img"></p>
<p>读端：</p>
<p><img src="/./assets/%E4%B8%96%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/format,png-20210408215150439.png" alt="img"></p>
<p>编译和执行：</p>
<p><img src="/./assets/%E4%B8%96%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/format,png-20210408215157588.png" alt="img"></p>
<p>这样我们会在/dev/shm/、/run/shm下面看到一个文件：</p>
<p><img src="/./assets/%E4%B8%96%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/format,png-20210408215203155.png" alt="img"></p>
<p>坦白讲，mmap、munmap这样的API让我找到了回家的感觉，刚入行做Linux的时候，写好framebuffer驱动后，就是把/dev/fb0 mmap到用户空间来操作，所以mmap这样的 API，真的是特别亲切，像亲人一样。</p>
<p>当然，如果你不喜欢shm_open()这个API，你也可以用常规的open来打开文件，然后进行mmap。关键的是mmap，wikipedia如是说：</p>
<p><img src="/./assets/%E4%B8%96%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/format,png-20210408215211094.png" alt="img"></p>
<p>mmap</p>
<p>In computing, mmap(2) is a POSIX-compliant Unix system call that maps files or devices into memory. It is a method of memory-mapped file I/O. It implements demand paging, because file contents are not read from disk directly and initially do not use physical RAM at all. The actual reads from disk are performed in a “lazy” manner, after a specific location is accessed. After the memory is no longer needed, it is important to munmap(2) the pointers to it. Protection information can be managed using mprotect(2), and special treatment can be enforced using madvise(2).</p>
<p>POSIX的共享内存，仍然符合我们前面说的tmpfs的特点，在运行了sw,sr后，再运行psw和psr，我们发现free命令再次戏剧性变化：</p>
<p><img src="/./assets/%E4%B8%96%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/format,png-20210408215219100.png" alt="img"></p>
<p>请将这个free命令的结果与前2次的free结果的各个字段进行对照:</p>
<p><img src="/./assets/%E4%B8%96%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/format,png-20210408215225519.jpeg" alt="img"></p>
<p>第3次比第2次的cached大了这么多？是因为我编写这篇文章边在访问磁盘里面的文件，当然POSIX的这个共享内存本身也导致cached增大了。</p>
<p>memfd_create</p>
<p>如果说POSIX的mmap让我找到回家的感觉，那么memfd_create()则是万般惊艳。见过这种API，才知道什么叫天生尤物——而且是尤物中的尤物，它完全属于那种让码农第一眼看到就会两眼充血，恨不得眼珠子夺眶而出贴到它身上去的那种API；一般人见到它第一次，都会忽略了它的长相，因为它的身材实在太火辣太抢眼了。</p>
<p>先不要浮想联翩，在所有的所有开始之前，我们要先提一下跨进程分享fd（文件描述符，对应我们很多时候说的“句柄”）这个重要的概念。</p>
<p>众所周知，Linux的fd属于一个进程级别的东西。进入每个进程的/proc/pid/fd可以看到它的fd的列表：</p>
<p><img src="/./assets/%E4%B8%96%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/format,png-20210408215235412.png" alt="img"></p>
<p>这个进程的0，1，2和那个进程的0，1，2不是一回事。</p>
<p>某年某月的某一天，人们发现，一个进程其实想访问另外一个进程的fd。当然，这只是目的不是手段。比如进程A有2个fd指向2片内存，如果进程B可以拿到这2个fd，其实就可以透过这2个fd访问到这2片内存。这个fd某种意义上充当了一个中间媒介的作用。有人说，那还不简单吗，如果进程A:</p>
<p>fd = open();</p>
<p>open()如果返回100，把这个100告诉进程B不就可以了吗，进程B访问这个100就可以了。这说明你还是没搞明白fd是一个进程内部的东西，是不能跨进程的概念。你的100和我的100，不是一个东西。这些基本的东西你搞不明白，你搞别的都是白搭。</p>
<p>Linux提供一个特殊的方法，可以把一个进程的fd甩锅、踢皮球给另外一个进程（其实“甩锅”这个词用在这里不合适，因为“甩锅”是一种推卸，而fd的传递是一种分享）。我特码一直想把我的bug甩（分）锅（享）出去，却发现总是被人把bug甩锅过来。</p>
<p>那么如何甩（分）锅（享）fd呢？</p>
<p>Linux里面的甩锅需要借助cmsg，用于在socket上传递控制消息（也称Ancillary data），使用SCM_RIGHTS，进程可以透过UNIX Socket把一个或者多个fd(file descriptor)传递给另外一个进程。</p>
<p>比如下面的这个函数，可以透过socket把fds指向的n个fd发送给另外一个进程：</p>
<p><img src="/./assets/%E4%B8%96%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/format,png-20210408215243422.png" alt="img"></p>
<p>而另外一个进程，则可以透过如下函数接受这个fd：</p>
<p><img src="/./assets/%E4%B8%96%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/format,png-20210408215249606.png" alt="img"></p>
<p>那么问题来了，如果在进程A中有一个文件的fd是100，发送给进程B后，它还是100吗？不能这么简单地理解，fd本身是一个进程级别的概念，每个进程有自己的fd的列表，比如进程B收到进程A的fd的时候，进程B自身fd空间里面自己的前面200个fd都已经被占用了，那么进程B接受到的fd就可能是201。数字本身在Linux的fd里面真地是一点都不重要，除了几个特殊的0,1,2这样的数字外。同样的，如果你把 cat /proc/interrupts 显示出的中断号就看成是硬件里面的中断偏移号码(比如ARM GIC里某号硬件中断)，你会发现，这个关系整个是一个瞎扯。</p>
<p><img src="/./assets/%E4%B8%96%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/format,png-20210408215257440.png" alt="img"></p>
<p>知道了甩锅API，那么重要的是，当它与memfd_create()结合的时候，我们准备甩出去的fd是怎么来？它是memfd_create()的返回值。</p>
<p>memfd_create()这个函数的玄妙之处在于它会返回一个“匿名”内存“文件”的fd，而它本身并没有实体的文件系统路径，其典型用法如下：</p>
<p><img src="/./assets/%E4%B8%96%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/format,png-20210408215306929.png" alt="img"></p>
<p>我们透过memfd_create()创建了一个“文件”，但是它实际映射到一片内存，而且在/xxx/yyy/zzz这样的文件系统下没有路径！没有路径！没有路径！</p>
<p>所以，当你在Linux里面编程的时候，碰到这样的场景：需要一个fd，当成文件一样操作，但是又不需要真实地位于文件系统，那么，就请立即使用memfd_create()吧，它的manual page是这样描述的：</p>
<p>memfd_create</p>
<p>memfd_create() creates an anonymous file and returns a file descriptor that refers to it.  The file behaves like a regular file, and so can be modified, truncated, memory-mapped, and so on.<br>However, unlike a regular file, it lives in RAM and has a volatile backing storage.</p>
<p><img src="/./assets/%E4%B8%96%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/format,png.gif" alt="img"></p>
<p>重点理解其中的regular这个单词。它的行动像一个regular的文件，但是它的背景却不regular。</p>
<p>那么，它和前面我们说的透过UNIX Socket甩锅fd又有什么关系呢？memfd_create()得到了fd，它在行为上类似规则的fd，所以也可以透过socket来进行甩锅，这样A进程相当于把一片与fd对应的内存，分享给了进程B。</p>
<p>下面的代码进程A通过memfd_create()创建了2片4MB的内存，并且透过socket（路径/tmp/fd-pass.socket）发送给进程B这2片内存对应的fd：</p>
<p><img src="/./assets/%E4%B8%96%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/format,png-20210408215333648.jpeg" alt="img"></p>
<p>下面的代码进程B透过相同的socket接受这2片内存对应的fd，之后通过read()读取每个文件的前256个字节并打印：</p>
<p><img src="/./assets/%E4%B8%96%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/format,png-20210408215340645.jpeg" alt="img"></p>
<p>上述代码参考了: </p>
<p><a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?u=aHR0cHM6Ly9vcGVuZm9ydW1zLndvcmRwcmVzcy5jb20vMjAxNi8wOC8wNy9vcGVuLWZpbGUtZGVzY3JpcHRvci1wYXNzaW5nLW92ZXItdW5peC1kb21haW4tc29ja2V0cy8">https://openforums.wordpress.com/2016/08/07/open-file-descriptor-passing-over-unix-domain-sockets/</a></p>
<p>上述的代码中，进程B是在进行read(fds[i], buffer, sizeof(buffer))，这体现了基于fd进行操作的regular特点。当然，如果是共享内存，现实的代码肯定还是多半会是mmap：</p>
<p>mmap(NULL, SIZE, PROT_READ, MAP_SHARED, fd, 0);</p>
<p>那么，透过socket发送memfd_create() fd来进行进程间共享内存这种方法，它究竟惊艳在哪里？</p>
<p>我认为首要的惊艳之处在于编程模型的惊艳。API简单、灵活、通用。进程之间想共享几片内存共享几片内存，想怎么共享怎么共享，想共享给谁共享给谁，无非是多了几个fd和socket的传递过程。比如，我从互联网上面收到了jpeg的视频码流，一帧帧的画面，进程A可以创建多片buffer来缓存画面，然后就可以透过把每片buffer对应的fd，递交给另外的进程去解码等。Avenue to Jane(大道至简)，简单的才是最好的！</p>
<p>memfd_create()的另外一个惊艳之处在于支持“封印”(sealing，就是你玩游戏的时候的封印)，sealing这个单词本身的意思是封条，在这个场景下，我更愿意把它翻译为“封印”。中国传说中的封印，多是采用如五行、太极、八卦等手段，并可有例如符咒、法器等物品的辅助。现指对某个单位施加一种力量，使其无法正常使用某些能力的本领（常出现于玄幻及神魔类作品，游戏中）。我这一生，最喜欢玩的游戏就是《仙剑奇侠传》和《轩辕剑——天之痕》，不知道是否暴露年龄了。</p>
<p>采用memfd_create()的场景下，我们同样可以用某种法器，来控制共享内存的shrink、grow和write。最初的设想可以详见File Sealing &amp; memfd_create()这篇文章：</p>
<p><a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?u=aHR0cHM6Ly9sd24ubmV0L0FydGljbGVzLzU5MTEwOC8">https://lwn.net/Articles/591108/</a></p>
<p>我们如果在共享内存上施加了这样的封印，则可以限制对此片区域的ftruncate、write等动作，并建立某种意义上进程之间的相互信任，这是不是很拉风？</p>
<p>还记得镇压孙悟空的五行山顶的封印吗？还记得孙悟空的紧箍咒吗？还记得悟空每次离开师傅的时候在师傅周围画的一个圈吗？</p>
<p><img src="/./assets/%E4%B8%96%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/format,png-20210408215351143.jpeg" alt="img"></p>
<p>封印</p>
<ul>
<li>SEAL_SHRINK: If set, the inode size cannot be reduced</li>
<li>SEAL_GROW: If set, the inode size cannot be increased</li>
<li>SEAL_WRITE: If set, the file content cannot be modified</li>
</ul>
<p><img src="/./assets/%E4%B8%96%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/format,png-20210408215504370.gif" alt="img"></p>
<p>File Sealing &amp; memfd_create()文中举到的一个典型使用场景是，如果graphics client把它与graphics compoistor共享的内存交给compoistor去render，compoistor必须保证可以拿到这片内存。这里面的风险是client可能透过ftruncate()把这个memory shrink小，这样compositor就拿不到完整的buffer，会造成crash。所以compositor只愿意接受含有SEAL_SHRINK封印的fd，如果没有，对不起，我们不能一起去西天取经。</p>
<p>在支持memfd_create()后，我们应尽可能地使用这种方式来替代传统的POSIX和SYS V，基本它也是一个趋势，比如我们在wayland相关项目中能看到这样的patch：</p>
<p><img src="/./assets/%E4%B8%96%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/format,png-20210408215512581.jpeg" alt="img"></p>
<p>dma_buf</p>
<p>dma_buf定义</p>
<p>The DMABUF framework provides a generic method for sharing buffers between multiple devices. Device drivers that support DMABUF can export a DMA buffer to userspace as a file descriptor (known as the exporter role), import a DMA buffer from userspace using a file descriptor previously exported for a different or the same device (known as the importer role), or both. </p>
<p><img src="/./assets/%E4%B8%96%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/format,png-20210408215521174.gif" alt="img"></p>
<p>简单地来说，dma_buf可以实现buffer在多个设备的共享，应用可以把一片底层驱动A的buffer导出到用户空间成为一个fd，也可以把fd导入到底层驱动 B。当然，如果进行mmap()得到虚拟地址，CPU也是可以在用户空间访问到已经获得用户空间虚拟地址的底层buffer的。</p>
<p><img src="/./assets/%E4%B8%96%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/format,png-20210408215527335.png" alt="img"></p>
<p>上图中，进程A访问设备A并获得其使用的buffer的fd，之后通过socket把fd发送给进程B，而后进程B导入fd到设备B，B获得对设备A中的buffer的共享访问。如果CPU也需要在用户态访问这片buffer，则进行了mmap()动作。</p>
<p>为什么我们要共享DMA buffer？想象一个场景：你要把你的屏幕framebuffer的内容透过gstreamer多媒体组件的服务，变成h264的视频码流，广播到网络上面，变成流媒体播放。在这个场景中，我们就想尽一切可能的避免内存拷贝。</p>
<p>技术上，管理framebuffer的驱动可以把这片buffer在底层实现为dma_buf，然后graphics compositor给这片buffer映射出来一个fd，之后透过socket发送fd 把这篇内存交给gstreamer相关的进程，如果gstreamer相关的“color space硬件转换”组件、“H264编码硬件组件”可以透过收到的fd还原出这些dma_buf的地址，则可以进行直接的加速操作了。比如color space透过接收到的fd1还原出framebuffer的地址，然后把转化的结果放到另外一片dma_buf，之后fd2对应这片YUV buffer被共享给h264编码器，h264编码器又透过fd2还原出YUV buffer的地址。</p>
<p><img src="/./assets/%E4%B8%96%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/format,png-20210408215535838.png" alt="img"></p>
<p>这里面的核心点就是fd只是充当了一个“句柄”，用户进程和设备驱动透过fd最终寻找到底层的dma_buf，实现buffer在进程和硬件加速组件之间的zero-copy，这里面唯一进行了exchange的就是fd。</p>
<p>再比如，如果把方向反过来，gstreamer从网络上收到了视频流，把它透过一系列动作转换为一片RGB的buffer，那么这片RGB的buffer最终还要在graphics compositor里面渲染到屏幕上，我们也需要透过dma_buf实现内存在video的decoder相关组件与GPU组件的共享。</p>
<p>Linux内核的V4L2驱动(encoder、decoder多采用此种驱动)、DRM(Direct Rendering Manager，framebuffer/GPU相关)等都支持dma_buf。比如在DRM之上，进程可以透过</p>
<p>int drmPrimeHandleToFD(int fd,</p>
<p>uint32_t handle,</p>
<p>uint32_t flags,</p>
<p>int * prime_fd </p>
<p>)</p>
<p>获得底层framebuffer对应的fd。如果这个fd被分享给gstreamer相关进程的video的color space转换，而color space转换硬件组件又被实现为一个V4L2驱动，则我们可以透过V4L2提供的如下接口，将这片buffer提供给V4L2驱动供其导入：</p>
<p><img src="/./assets/%E4%B8%96%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/format,png-20210408215545396.png" alt="img"></p>
<p>如果是multi plane的话，则需要导入多个fd：</p>
<p><img src="/./assets/%E4%B8%96%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/format,png-20210408215552177.png" alt="img"></p>
<p>相关细节可以参考这个文档：</p>
<p><a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?u=aHR0cHM6Ly9saW51eHR2Lm9yZy9kb3dubG9hZHMvdjRsLWR2Yi1hcGlzL3VhcGkvdjRsL2RtYWJ1Zi5odG1s">https://linuxtv.org/downloads/v4l-dvb-apis/uapi/v4l/dmabuf.html</a></p>
<p>一切都是文件！不是文件创造条件也要把它变成文件！这就是Linux的世界观。是不是文件不重要，关键是你得觉得它是个文件。在dma_buf的场景下，fd这个东西，纯粹就是个”句柄”，方便大家通过这么一个fd能够对应到最终硬件需要访问的buffer。所以，透过fd的分享和传递，实际实现跨进程、跨设备（包括CPU）的内存共享。</p>
<p>如果说前面的SYS V、POSIX、memfd_create()更加强调内存在进程间的共享，那么dma_buf则更加强调内存在设备间的共享，它未必需要跨进程。比如：</p>
<p><img src="/./assets/%E4%B8%96%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/format,png-20210408215600171.png" alt="img"></p>
<p>有的童鞋说，为嘛在一个进程里面设备A和B共享内存还需要fd来倒腾一遍呢？我直接设备A驱动弄个全局变量存buffer的物理地址，设备B的驱动访问这个全局变量不就好了吗？我只能说，你对Linux内核的只提供机制不提供策略，以及软件工程每个模块各司其责，高内聚和低耦合的理解，还停留在裸奔的阶段。在没有dma_buf等类似机制的情况下，如果用户空间仍然负责构建策略并连接设备A和B，人们为了追求代码的干净，往往要进行这样的内存拷贝：</p>
<p><img src="/./assets/%E4%B8%96%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/format,png-20210408215607387.png" alt="img"></p>
<p>dma_buf的支持依赖于驱动层是否实现了相关的callbacks。比如在v4l2驱动中，v4l2驱动支持把dma_buf导出（前面讲了v4l2也支持dma_buf的导入，关键看数据方向），它的代码体现在：</p>
<p>drivers/media/common/videobuf2/videobuf2-dma-contig.c中的：</p>
<p><img src="/./assets/%E4%B8%96%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/format,png-20210408215615006.png" alt="img"></p>
<p>其中的vb2_dc_dmabuf_ops是一个struct dma_buf_ops，它含有多个成员函数：</p>
<p><img src="/./assets/%E4%B8%96%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/format,png-20210408215624632.png" alt="img"></p>
<p>当用户call VIDIOC_EXPBUF这个IOCTL的时候，可以把dma_buf转化为fd：</p>
<p>int ioctl(int fd, VIDIOC_EXPBUF, struct v4l2_exportbuffer *argp);</p>
<p>对应着驱动层的代码则会调用dma_buf_fd()：</p>
<p><img src="/./assets/%E4%B8%96%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/format,png-20210408215631492.png" alt="img"></p>
<p>应用程序可以通过如下方式拿到底层的dma_buf的fd：</p>
<p><img src="/./assets/%E4%B8%96%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/format,png-20210408215637250.png" alt="img"></p>
<p>dma_buf的导入侧设备驱动，则会用到如下这些API：</p>
<p>dma_buf_attach()</p>
<p>dma_buf_map_attachment()</p>
<p>dma_buf_unmap_attachment()</p>
<p>dma_buf_detach()</p>
<p>下面这张表，是笔者对这几种共享内存方式总的归纳：</p>
<p><img src="/./assets/%E4%B8%96%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98/format,png-20210408215645563.png" alt="img"></p>
<p>落花满天蔽月光，借一杯附荐凤台上。</p>
<p>全剧终<br>————————————————<br>版权声明：本文为CSDN博主「宋宝华」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。<br>原文链接：<a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?u=aHR0cHM6Ly9ibG9nLmNzZG4ubmV0LzIxY25iYW8vYXJ0aWNsZS9kZXRhaWxzLzEwMzQ3MDg3OA">https://blog.csdn.net/21cnbao/article/details/103470878</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://blog.phoenine.top">Phoenine</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://blog.phoenine.top/posts/9d6dba6f/">https://blog.phoenine.top/posts/9d6dba6f/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://blog.phoenine.top" target="_blank">因受</a>！</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="/img/cover/shark.png" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer=""></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/39b0a4c/" title="Golang net包简介"><img class="cover" src="/img/cover/radian.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Golang net包简介</div></div><div class="info-2"><div class="info-item-1">Golang net 包简介 golang 的 net 包，相关接口和结构比较多，今天做个简单的梳理。  1.  网络模型在总结 net 包之前，还需要温习模糊的网络模型知识。下图是大学课本上的网络模型图：   模型图中可以看到，OSI 的七层模型，每一层实现的是与对端相应层的通信接口。但是实际应用中，我们把会话层、表示层、应用层统称为应用层。因此，就变成了TCP/IP 的五层模型。 其中网络层包含了 ip,arp,icmp 等协议，传输层包含了 TCP， UDP 等协议，应用层，比如 SMTP，DNS，HTTP 等协议。在 net 包中，主要涉及网络层和传输层的协议。支持如下：网络层：  ICMP IGMP IVP6-ICMP  传输层：  TCP UDP  2.  Socket 编程在讲代码结构前，还需要回忆（学习）几个 Socket 编程(套接字编程)的知识点。  在 Linux 上一切皆文件。所以各端口的读写服务可以认为是读取/写入文件, 一般使用文件描述符 fd (file descriptor) 表示。在Windows上，各端口的读写服务是一个通信...</div></div></div></a><a class="pagination-related" href="/posts/34c6a9d1/" title="论一切都是文件之匿名inode"><img class="cover" src="/img/cover/shark.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">论一切都是文件之匿名inode</div></div><div class="info-2"><div class="info-item-1">1.  宋宝华：论一切都是文件之匿名inode01 唯有文件得人心 当一个女生让你替她抓100只萤火虫，她一定不是为了折磨你，而是因为她爱上了你。当你们之间经历了无数的恩恩怨怨和彼此伤害，她再次让你替她抓100只萤火虫，那一定是因为她还爱着你。   为什么？因为这就是套路，是在下偶尔瞟一眼古装肥皂剧总结出来的套路。 Linux里面最大的套路，就是“一切都是文件”。爱一个人，就为她捉萤火虫；做一件事，就让它成为一个“文件”。  为什么自古深情留不住，唯有“文件”得人心呢？因为文件在用户态最直观的形式是随着一次open，获得一个fd，有了这个fd，长城内外，你基本可以为所欲为：  在本进程内，fd的最直观操作是open、close、mmap、ioctl、poll这些。 m map 让你具备把fd透射到内存的能力，所以你可以通过指针访问文件的内容。再者，这个mmap，如果底层透射的是framebuffer、V4L2、DRM等，则让我们具备了从用户态操作底层显存、多媒体数据等的能力；比如，无论是V4L2还是DRM，都支持把底层的dma_buf导出为fd。poll则提供给用户阻塞等待某事件...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"></div><div class="author-info-name">Phoenine</div><div class="author-info-description">中年危机 | 码字困难户</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">69</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">22</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">19</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://wpa.qq.com/msgrd?v=3&amp;uin=19974979&amp;site=qq&amp;menu=yes" target="_blank" title="QQ"><i class="fab fa-qq"></i></a><a class="social-icon" href="/social/wechat/" target="_blank" title="WeChatChat"><i class="fab fa-weixin"></i></a><a class="social-icon" href="https://github.com/phoenine" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:sparkbye@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%AE%8B%E5%AE%9D%E5%8D%8E%EF%BC%9A%E4%B8%96%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98"><span class="toc-text">1.  宋宝华：世上最好的共享内存</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/13bfb908/" title="用「记忆闪卡 Dashboard」高效学习：费曼技巧 × 间隔复习">用「记忆闪卡 Dashboard」高效学习：费曼技巧 × 间隔复习</a><time datetime="2025-09-20T10:55:26.809Z" title="发表于 2025-09-20 18:55:26">2025-09-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/aed033e2/" title="🏆 Notion积分打卡 3.0 —— 自律升级，像玩 RPG 一样坚持习惯">🏆 Notion积分打卡 3.0 —— 自律升级，像玩 RPG 一样坚持习惯</a><time datetime="2025-09-20T02:19:54.074Z" title="发表于 2025-09-20 10:19:54">2025-09-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/812138c9/" title="Dash安装docset">Dash安装docset</a><time datetime="2025-05-28T12:49:13.591Z" title="发表于 2025-05-28 20:49:13">2025-05-28</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"></div><div class="footer_custom_text"><div class="my-footer-svg-div">
  <svg class="my-footer-wave-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 100" preserveAspectRatio="none">
  <path class="my-footer-wave-path" d="M851.8,100c125,0,288.3-45,348.2-64V0H0v44c3.7-1,7.3-1.9,11-2.9C80.7,22,151.7,10.8,223.5,6.3C276.7,2.9,330,4,383,9.8 c52.2,5.7,103.3,16.2,153.4,32.8C623.9,71.3,726.8,100,851.8,100z"></path>
  </svg>
</div>
<div class="my-footer-content-div">
<div class="my-footer-content">
    <div class="my-footer-content-column">
        <div class="my-footer-logo">
            <a class="my-footer-logo-link" href="/">
                <span class="hidden-link-text">LOGO</span>
                <img src="/img/footer/qlogo_white_no_words.png" style="height:40%; width:40%">
            </a>
        </div>
        <div class="my-footer-menu">
            <h2 class="my-footer-menu-name">开始</h2>
            <ul id="menu-get-started" class="my-footer-menu-list">
                <li class="menu-item menu-item-type-post_type menu-item-object-product">
                    <a href="/pages/about.html">关于本站</a>
                </li>
            </ul>
        </div>
    </div>
    <div class="my-footer-content-column">
        <div class="my-footer-menu">
            <h2 class="my-footer-menu-name">快速链接</h2>
            <ul id="menu-company" class="my-footer-menu-list">
                <li class="menu-item menu-item-type-post_type menu-item-object-product">
                    <a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/">Hexo</a>&nbsp;⨯&nbsp;<a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a>
                </li>
                <li class="menu-item menu-item-type-taxonomy menu-item-object-category">
                    <a href="/archives/">时间轴</a>&nbsp;|&nbsp;<a href="/DO_NOT_render/cosmoscope/cosmoscope_trim.html">关系图</a>&nbsp;|&nbsp;<a href="/categories/">分类</a>
                </li>
                <li class="menu-item menu-item-type-post_type menu-item-object-product">
                    <a target="_blank" rel="noopener" href="https://blog.uuanqin.top/p/91b7dad/">同款页脚</a>
                </li>
                <li class="menu-item menu-item-type-post_type menu-item-object-product">
                    <a href="https://www.foreverblog.cn/" rel="noopener external nofollow noreferrer" target="_blank"> <img class="img-foreverblog" src="/img/footer/forever_logo_en_default_white.png" alt="" style="width:auto;height:21px;margin-top:6px"> </a>
                </li>
            </ul>
        </div>

    </div>

    <div class="my-footer-content-column">
        <div class="my-footer-menu">
            <h2 class="my-footer-menu-name">法律声明</h2>
            <ul id="menu-legal" class="my-footer-menu-list">
                <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-privacy-policy menu-item-170434">
                    <a href="/pages/privacy.html">隐私政策</a>
                </li>
            </ul>
        </div>
        <div class="my-footer-call-to-action">
            <h2 class="my-footer-call-to-action-title">联系本站</h2>
            <ul id="menu-legal" class="my-footer-menu-list">
                <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-privacy-policy menu-item-170434">
                    <a href="/DO_NOT_render/wechatOA/index.html">微信公众号</a>
                </li>

                <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-privacy-policy menu-item-170434">
                    <a class="my-footer-call-to-action-link" href="mailto:contact@phoenine.top" target="_self">
                        cont<span style="display:none">@</span><!-- >@ -->act@<span style="display:none">@</span>phoe<!-- >@. -->nine<span style="display:none">@</span>.top
                    </a>
                </li>

            </ul>
        </div>

    </div>
    <div class="my-footer-content-column">
        <ul id="menu-get-started" class="my-footer-menu-list">
            <li class="menu-item menu-item-type-post_type menu-item-object-product">
                <a href="https://notbyai.fyi/" target="_blank" rel="external nofollow noopener noreferrer"><img class="img-not-ai" src="/img/footer/Written-By-Human-Not-By-AI-Badge-white.svg" alt="Written by Human, Not by AI"></a>
            </li>
            <li class="menu-item menu-item-type-post_type menu-item-object-product">
                <a href="/pages/cc.html"><img src="/img/footer/by-nc-sa.svg" alt="署名-非商业性使用-相同方式共享 4.0 国际"></a>
            </li>

            <li class="menu-item menu-item-type-post_type menu-item-object-product">
                ©2022-2025 By Phoenine
            </li>
        </ul>
    </div>

    <div class="my-footer-social-links"> <svg class="my-footer-social-amoeba-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 236 54">
        <path class="my-footer-social-amoeba-path" d="M223.06,43.32c-.77-7.2,1.87-28.47-20-32.53C187.78,8,180.41,18,178.32,20.7s-5.63,10.1-4.07,16.7-.13,15.23-4.06,15.91-8.75-2.9-6.89-7S167.41,36,167.15,33a18.93,18.93,0,0,0-2.64-8.53c-3.44-5.5-8-11.19-19.12-11.19a21.64,21.64,0,0,0-18.31,9.18c-2.08,2.7-5.66,9.6-4.07,16.69s.64,14.32-6.11,13.9S108.35,46.5,112,36.54s-1.89-21.24-4-23.94S96.34,0,85.23,0,57.46,8.84,56.49,24.56s6.92,20.79,7,24.59c.07,2.75-6.43,4.16-12.92,2.38s-4-10.75-3.46-12.38c1.85-6.6-2-14-4.08-16.69a21.62,21.62,0,0,0-18.3-9.18C13.62,13.28,9.06,19,5.62,24.47A18.81,18.81,0,0,0,3,33a21.85,21.85,0,0,0,1.58,9.08,16.58,16.58,0,0,1,1.06,5A6.75,6.75,0,0,1,0,54H236C235.47,54,223.83,50.52,223.06,43.32Z"></path>
    </svg>
        <a class="my-footer-social-link github" href="https://github.com/phoenine" target="_blank" rel="external nofollow noopener noreferrer">
            <span class="hidden-link-text">Github</span>
            <svg class="my-footer-social-icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32">
                <path class="my-footer-social-icon-path" d="M 16 4 C 9.371094 4 4 9.371094 4 16 C 4 21.300781 7.4375 25.800781 12.207031 27.386719 C 12.808594 27.496094 13.027344 27.128906 13.027344 26.808594 C 13.027344 26.523438 13.015625 25.769531 13.011719 24.769531 C 9.671875 25.492188 8.96875 23.160156 8.96875 23.160156 C 8.421875 21.773438 7.636719 21.402344 7.636719 21.402344 C 6.546875 20.660156 7.71875 20.675781 7.71875 20.675781 C 8.921875 20.761719 9.554688 21.910156 9.554688 21.910156 C 10.625 23.746094 12.363281 23.214844 13.046875 22.910156 C 13.15625 22.132813 13.46875 21.605469 13.808594 21.304688 C 11.144531 21.003906 8.34375 19.972656 8.34375 15.375 C 8.34375 14.0625 8.8125 12.992188 9.578125 12.152344 C 9.457031 11.851563 9.042969 10.628906 9.695313 8.976563 C 9.695313 8.976563 10.703125 8.65625 12.996094 10.207031 C 13.953125 9.941406 14.980469 9.808594 16 9.804688 C 17.019531 9.808594 18.046875 9.941406 19.003906 10.207031 C 21.296875 8.65625 22.300781 8.976563 22.300781 8.976563 C 22.957031 10.628906 22.546875 11.851563 22.421875 12.152344 C 23.191406 12.992188 23.652344 14.0625 23.652344 15.375 C 23.652344 19.984375 20.847656 20.996094 18.175781 21.296875 C 18.605469 21.664063 18.988281 22.398438 18.988281 23.515625 C 18.988281 25.121094 18.976563 26.414063 18.976563 26.808594 C 18.976563 27.128906 19.191406 27.503906 19.800781 27.386719 C 24.566406 25.796875 28 21.300781 28 16 C 28 9.371094 22.628906 4 16 4 Z "></path>
            </svg>
        </a>
        <a class="my-footer-social-link email" href="mailto:sparkbye@phoenine.com" target="_blank" rel="external nofollow noopener noreferrer">
            <span class="hidden-link-text">Email</span>
            <svg class="my-footer-social-icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                <!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. -->
                <path class="my-footer-social-icon-path" d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4L236.8 313.6c11.4 8.5 27 8.5 38.4 0L492.8 150.4c12.1-9.1 19.2-23.3 19.2-38.4c0-26.5-21.5-48-48-48H48zM0 176V384c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V176L294.4 339.2c-22.8 17.1-54 17.1-76.8 0L0 176z"></path>
            </svg>
        </a>
        <a class="my-footer-social-link follow" href="https://app.follow.is/share/users/phoenine" target="_blank" rel="external nofollow noopener noreferrer">
            <span class="hidden-link-text">Follow</span>
            <svg class="my-footer-social-icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
              <!--!Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
              <path class="my-footer-social-icon-path" d="M64 32C28.7 32 0 60.7 0 96L0 416c0 35.3 28.7 64 64 64l320 0c35.3 0 64-28.7 64-64l0-320c0-35.3-28.7-64-64-64L64 32zM96 136c0-13.3 10.7-24 24-24c137 0 248 111 248 248c0 13.3-10.7 24-24 24s-24-10.7-24-24c0-110.5-89.5-200-200-200c-13.3 0-24-10.7-24-24zm0 96c0-13.3 10.7-24 24-24c83.9 0 152 68.1 152 152c0 13.3-10.7 24-24 24s-24-10.7-24-24c0-57.4-46.6-104-104-104c-13.3 0-24-10.7-24-24zm0 120a32 32 0 1 1 64 0 32 32 0 1 1 -64 0z"></path>
            </svg>
        </a>
        <a class="my-footer-social-link rss" href="/atom.xml" target="_blank" rel="external nofollow noopener noreferrer">
            <span class="hidden-link-text">RSS</span>
            <svg class="my-footer-social-icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
                <!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. -->
                <path class="my-footer-social-icon-path" d="M0 64C0 46.3 14.3 32 32 32c229.8 0 416 186.2 416 416c0 17.7-14.3 32-32 32s-32-14.3-32-32C384 253.6 226.4 96 32 96C14.3 96 0 81.7 0 64zM0 416a64 64 0 1 1 128 0A64 64 0 1 1 0 416zM32 160c159.1 0 288 128.9 288 288c0 17.7-14.3 32-32 32s-32-14.3-32-32c0-123.7-100.3-224-224-224c-17.7 0-32-14.3-32-32s14.3-32 32-32z"></path>
            </svg>
        </a>

    </div>
</div>
</div>
<div class="my-footer-copyright">
    <div class="my-footer-copyright-wrapper">
        <p class="my-footer-copyright-text">
            <a target="_blank" href="https://beian.miit.gov.cn/" rel="noopener external nofollow noreferrer noopener"><img class="icp-icon" src="/img/footer/icp.ico"><span>暂时没有备案</span></a>
            &nbsp;|&nbsp;<a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=12011202000621" rel="noopener external nofollow noreferrer noopener"><img class="icp-icon" src="/img/footer/beian_logo.png"><span>暂时没有备案</span></a>
            &nbsp;|&nbsp;&nbsp;
            <span>违法与不良信息举报邮箱&nbsp;
              cont<span style="display:none">@</span><!-- >@ -->act@<span style="display:none">@</span>phoe<!-- >@. -->nine<span style="display:none">@</span>.top
            </span>
        </p>
    </div>
</div>
</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.1"></script><script src="/js/main.js?v=5.5.1"></script><div class="js-pjax"></div><script async="" data-pjax="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden="hidden"></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div id="algolia-search-input"><div class="ais-SearchBox"><form class="ais-SearchBox-form" action="" role="search" novalidate=""><input class="ais-SearchBox-input" type="search" placeholder="搜索文章" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" maxlength="512" aria-label="Search"><button class="ais-SearchBox-submit" type="submit" title="Submit the search query" style="display:none;"><svg class="ais-SearchBox-submitIcon" width="10" height="10" viewBox="0 0 40 40" aria-hidden="true"><path d="M26.804 29.01c-2.832 2.34-6.465 3.746-10.426 3.746C7.333 32.756 0 25.424 0 16.378 0 7.333 7.333 0 16.378 0c9.046 0 16.378 7.333 16.378 16.378 0 3.96-1.406 7.594-3.746 10.426l10.534 10.534c.607.607.61 1.59-.004 2.202-.61.61-1.597.61-2.202.004L26.804 29.01zm-10.426.627c7.323 0 13.26-5.936 13.26-13.26 0-7.32-5.937-13.257-13.26-13.257C9.056 3.12 3.12 9.056 3.12 16.378c0 7.323 5.936 13.26 13.258 13.26z"></path></svg></button></form></div><hr><div id="algolia-search-results"><div id="algolia-hits"><div id="algolia-hits-empty" style="display:none;"></div><div class="ais-Hits" style="display:none;"><ol class="ais-Hits-list"></ol></div></div><div class="ais-Pagination" id="algolia-pagination" style="display:none;"><ul class="ais-Pagination-list"></ul></div><div id="algolia-info"><span class="ais-Stats-text"></span><a class="algolia-poweredBy" href="https://www.algolia.com/?utm_source=algoliasearch.js&amp;utm_medium=website&amp;utm_content=localhost&amp;utm_campaign=poweredby" target="_blank" aria-label="Search by Algolia" rel="noopener noreferrer"><svg class="ais-PoweredBy-logo" height="1.2em" viewBox="0 0 572 64" style="width: auto;"><path fill="#36395A" d="M16 48.3c-3.4 0-6.3-.6-8.7-1.7A12.4 12.4 0 0 1 1.9 42C.6 40 0 38 0 35.4h6.5a6.7 6.7 0 0 0 3.9 6c1.4.7 3.3 1.1 5.6 1.1 2.2 0 4-.3 5.4-1a7 7 0 0 0 3-2.4 6 6 0 0 0 1-3.4c0-1.5-.6-2.8-1.9-3.7-1.3-1-3.3-1.6-5.9-1.8l-4-.4c-3.7-.3-6.6-1.4-8.8-3.4a10 10 0 0 1-3.3-7.9c0-2.4.6-4.6 1.8-6.4a12 12 0 0 1 5-4.3c2.2-1 4.7-1.6 7.5-1.6s5.5.5 7.6 1.6a12 12 0 0 1 5 4.4c1.2 1.8 1.8 4 1.8 6.7h-6.5a6.4 6.4 0 0 0-3.5-5.9c-1-.6-2.6-1-4.4-1s-3.2.3-4.4 1c-1.1.6-2 1.4-2.6 2.4-.5 1-.8 2-.8 3.1a5 5 0 0 0 1.5 3.6c1 1 2.6 1.7 4.7 1.9l4 .3c2.8.2 5.2.8 7.2 1.8 2.1 1 3.7 2.2 4.9 3.8a9.7 9.7 0 0 1 1.7 5.8c0 2.5-.7 4.7-2 6.6a13 13 0 0 1-5.6 4.4c-2.4 1-5.2 1.6-8.4 1.6Zm35.6 0c-2.6 0-4.8-.4-6.7-1.3a13 13 0 0 1-4.7-3.5 17.1 17.1 0 0 1-3.6-10.4v-1c0-2 .3-3.8 1-5.6a13 13 0 0 1 7.3-8.3 15 15 0 0 1 6.3-1.4A13.2 13.2 0 0 1 64 24.3c1 2.2 1.6 4.6 1.6 7.2V34H39.4v-4.3h21.8l-1.8 2.2c0-2-.3-3.7-.9-5.1a7.3 7.3 0 0 0-2.7-3.4c-1.2-.7-2.7-1.1-4.6-1.1s-3.4.4-4.7 1.3a8 8 0 0 0-2.9 3.6c-.6 1.5-.9 3.3-.9 5.4 0 2 .3 3.7 1 5.3a7.9 7.9 0 0 0 2.8 3.7c1.3.8 3 1.3 5 1.3s3.8-.5 5.1-1.3c1.3-1 2.1-2 2.4-3.2h6a11.8 11.8 0 0 1-7 8.7 16 16 0 0 1-6.4 1.2ZM80 48c-2.2 0-4-.3-5.7-1a8.4 8.4 0 0 1-3.7-3.3 9.7 9.7 0 0 1-1.3-5.2c0-2 .5-3.8 1.5-5.2a9 9 0 0 1 4.3-3.1c1.8-.7 4-1 6.7-1H89v4.1h-7.5c-2 0-3.4.5-4.4 1.4-1 1-1.6 2.1-1.6 3.6s.5 2.7 1.6 3.6c1 1 2.5 1.4 4.4 1.4 1.1 0 2.2-.2 3.2-.7 1-.4 1.9-1 2.6-2 .6-1 1-2.4 1-4.2l1.7 2.1c-.2 2-.7 3.8-1.5 5.2a9 9 0 0 1-3.4 3.3 12 12 0 0 1-5.3 1Zm9.5-.7v-8.8h-1v-10c0-1.8-.5-3.2-1.4-4.1-1-1-2.4-1.4-4.2-1.4a142.9 142.9 0 0 0-10.2.4v-5.6a74.8 74.8 0 0 1 8.6-.4c3 0 5.5.4 7.5 1.2s3.4 2 4.4 3.6c1 1.7 1.4 4 1.4 6.7v18.4h-5Zm12.9 0V17.8h5v12.3h-.2c0-4.2 1-7.4 2.8-9.5a11 11 0 0 1 8.3-3.1h1v5.6h-2a9 9 0 0 0-6.3 2.2c-1.5 1.5-2.2 3.6-2.2 6.4v15.6h-6.4Zm34.4 1a15 15 0 0 1-6.6-1.3c-1.9-.9-3.4-2-4.7-3.5a15.5 15.5 0 0 1-2.7-5c-.6-1.7-1-3.6-1-5.4v-1c0-2 .4-3.8 1-5.6a15 15 0 0 1 2.8-4.9c1.3-1.5 2.8-2.6 4.6-3.5a16.4 16.4 0 0 1 13.3.2c2 1 3.5 2.3 4.8 4a12 12 0 0 1 2 6H144c-.2-1.6-1-3-2.2-4.1a7.5 7.5 0 0 0-5.2-1.7 8 8 0 0 0-4.7 1.3 8 8 0 0 0-2.8 3.6 13.8 13.8 0 0 0 0 10.3c.6 1.5 1.5 2.7 2.8 3.6s2.8 1.3 4.8 1.3c1.5 0 2.7-.2 3.8-.8a7 7 0 0 0 2.6-2c.7-1 1-2 1.2-3.2h6.2a11 11 0 0 1-2 6.2 15.1 15.1 0 0 1-11.8 5.5Zm19.7-1v-40h6.4V31h-1.3c0-3 .4-5.5 1.1-7.6a9.7 9.7 0 0 1 3.5-4.8A9.9 9.9 0 0 1 172 17h.3c3.5 0 6 1.1 7.9 3.5 1.7 2.3 2.6 5.7 2.6 10v16.8h-6.4V29.6c0-2.1-.6-3.8-1.8-5a6.4 6.4 0 0 0-4.8-1.8c-2 0-3.7.7-5 2a7.8 7.8 0 0 0-1.9 5.5v17h-6.4Zm63.8 1a12.2 12.2 0 0 1-10.9-6.2 19 19 0 0 1-1.8-7.3h1.4v12.5h-5.1v-40h6.4v19.8l-2 3.5c.2-3.1.8-5.7 1.9-7.7a11 11 0 0 1 4.4-4.5c1.8-1 3.9-1.5 6.1-1.5a13.4 13.4 0 0 1 12.8 9.1c.7 1.9 1 3.8 1 6v1c0 2.2-.3 4.1-1 6a13.6 13.6 0 0 1-13.2 9.4Zm-1.2-5.5a8.4 8.4 0 0 0 7.9-5c.7-1.5 1.1-3.3 1.1-5.3s-.4-3.8-1.1-5.3a8.7 8.7 0 0 0-3.2-3.6 9.6 9.6 0 0 0-9.2-.2 8.5 8.5 0 0 0-3.3 3.2c-.8 1.4-1.3 3-1.3 5v2.3a9 9 0 0 0 1.3 4.8 9 9 0 0 0 3.4 3c1.4.7 2.8 1 4.4 1Zm27.3 3.9-10-28.9h6.5l9.5 28.9h-6Zm-7.5 12.2v-5.7h4.9c1 0 2-.1 2.9-.4a4 4 0 0 0 2-1.4c.4-.7.9-1.6 1.2-2.7l8.6-30.9h6.2l-9.3 32.4a14 14 0 0 1-2.5 5 8.9 8.9 0 0 1-4 2.8c-1.5.6-3.4.9-5.6.9h-4.4Zm9-12.2v-5.2h6.4v5.2H248Z"></path><path fill="#003DFF" d="M534.4 9.1H528a.8.8 0 0 1-.7-.7V1.8c0-.4.2-.7.6-.8l6.5-1c.4 0 .8.2.9.6v7.8c0 .4-.4.7-.8.7zM428 35.2V.8c0-.5-.3-.8-.7-.8h-.2l-6.4 1c-.4 0-.7.4-.7.8v35c0 1.6 0 11.8 12.3 12.2.5 0 .8-.4.8-.8V43c0-.4-.3-.7-.6-.8-4.5-.5-4.5-6-4.5-7zm106.5-21.8H528c-.4 0-.7.4-.7.8v34c0 .4.3.8.7.8h6.5c.4 0 .8-.4.8-.8v-34c0-.5-.4-.8-.8-.8zm-17.7 21.8V.8c0-.5-.3-.8-.8-.8l-6.5 1c-.4 0-.7.4-.7.8v35c0 1.6 0 11.8 12.3 12.2.4 0 .8-.4.8-.8V43c0-.4-.3-.7-.7-.8-4.4-.5-4.4-6-4.4-7zm-22.2-20.6a16.5 16.5 0 0 1 8.6 9.3c.8 2.2 1.3 4.8 1.3 7.5a19.4 19.4 0 0 1-4.6 12.6 14.8 14.8 0 0 1-5.2 3.6c-2 .9-5.2 1.4-6.8 1.4a21 21 0 0 1-6.7-1.4 15.4 15.4 0 0 1-8.6-9.3 21.3 21.3 0 0 1 0-14.4 15.2 15.2 0 0 1 8.6-9.3c2-.8 4.3-1.2 6.7-1.2s4.6.4 6.7 1.2zm-6.7 27.6c2.7 0 4.7-1 6.2-3s2.2-4.3 2.2-7.8-.7-6.3-2.2-8.3-3.5-3-6.2-3-4.7 1-6.1 3c-1.5 2-2.2 4.8-2.2 8.3s.7 5.8 2.2 7.8 3.5 3 6.2 3zm-88.8-28.8c-6.2 0-11.7 3.3-14.8 8.2a18.6 18.6 0 0 0 4.8 25.2c1.8 1.2 4 1.8 6.2 1.7s.1 0 .1 0h.9c4.2-.7 8-4 9.1-8.1v7.4c0 .4.3.7.8.7h6.4a.7.7 0 0 0 .7-.7V14.2c0-.5-.3-.8-.7-.8h-13.5zm6.3 26.5a9.8 9.8 0 0 1-5.7 2h-.5a10 10 0 0 1-9.2-14c1.4-3.7 5-6.3 9-6.3h6.4v18.3zm152.3-26.5h13.5c.5 0 .8.3.8.7v33.7c0 .4-.3.7-.8.7h-6.4a.7.7 0 0 1-.8-.7v-7.4c-1.2 4-4.8 7.4-9 8h-.1a4.2 4.2 0 0 1-.5.1h-.9a10.3 10.3 0 0 1-7-2.6c-4-3.3-6.5-8.4-6.5-14.2 0-3.7 1-7.2 3-10 3-5 8.5-8.3 14.7-8.3zm.6 28.4c2.2-.1 4.2-.6 5.7-2V21.7h-6.3a9.8 9.8 0 0 0-9 6.4 10.2 10.2 0 0 0 9.1 13.9h.5zM452.8 13.4c-6.2 0-11.7 3.3-14.8 8.2a18.5 18.5 0 0 0 3.6 24.3 10.4 10.4 0 0 0 13 .6c2.2-1.5 3.8-3.7 4.5-6.1v7.8c0 2.8-.8 5-2.2 6.3-1.5 1.5-4 2.2-7.5 2.2l-6-.3c-.3 0-.7.2-.8.5l-1.6 5.5c-.1.4.1.8.5 1h.1c2.8.4 5.5.6 7 .6 6.3 0 11-1.4 14-4.1 2.7-2.5 4.2-6.3 4.5-11.4V14.2c0-.5-.4-.8-.8-.8h-13.5zm6.3 8.2v18.3a9.6 9.6 0 0 1-5.6 2h-1a10.3 10.3 0 0 1-8.8-14c1.4-3.7 5-6.3 9-6.3h6.4zM291 31.5A32 32 0 0 1 322.8 0h30.8c.6 0 1.2.5 1.2 1.2v61.5c0 1.1-1.3 1.7-2.2 1l-19.2-17a18 18 0 0 1-11 3.4 18.1 18.1 0 1 1 18.2-14.8c-.1.4-.5.7-.9.6-.1 0-.3 0-.4-.2l-3.8-3.4c-.4-.3-.6-.8-.7-1.4a12 12 0 1 0-2.4 8.3c.4-.4 1-.5 1.6-.2l14.7 13.1v-46H323a26 26 0 1 0 10 49.7c.8-.4 1.6-.2 2.3.3l3 2.7c.3.2.3.7 0 1l-.2.2a32 32 0 0 1-47.2-28.6z"></path></svg></a></div></div></div></div><div id="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/algoliasearch@5.39.0/dist/lite/builds/browser.umd.min.js"></script><script src="/js/search/algolia.js?v=5.5.1"></script></div></div><!-- hexo injector body_end start --> <script data-pjax="">if(document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
    var parent = document.getElementById('recent-posts');
    var child = '<div class="recent-post-item" style="width:100%;height: auto"><div id="catalog_magnet"><div class="magnet_item"><a class="magnet_link" href="https://blog.phoenine.top/categories/常用工具/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🛠️ 常用工具 (19)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://blog.phoenine.top/categories/操作系统/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🖥️ 操作系统 (10)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://blog.phoenine.top/categories/百味人生/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🍵 百味人生 (4)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://blog.phoenine.top/categories/知识积累/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">📚 知识积累 (5)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://blog.phoenine.top/categories/算法分析/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🧠 算法分析 (2)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://blog.phoenine.top/categories/系统架构/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🏗️ 系统架构 (2)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://blog.phoenine.top/categories/编程语法/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">👩‍💻 编程语法 (26)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://blog.phoenine.top/categories/人工智能/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🤖 人工智能 (1)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item" style="visibility: hidden"></div><a class="magnet_link_more"  href="https://blog.phoenine.top/categories" style="flex:1;text-align: center;margin-bottom: 10px;">查看更多...</a></div></div>';
    console.log('已挂载magnet')
    parent.insertAdjacentHTML("afterbegin",child)}
     </script><style>#catalog_magnet{flex-wrap: wrap;display: flex;width:100%;justify-content:space-between;padding: 10px 10px 0 10px;align-content: flex-start;}.magnet_item{flex-basis: calc(33.333333333333336% - 5px);background: #f2f2f2;margin-bottom: 10px;border-radius: 8px;transition: all 0.2s ease-in-out;}.magnet_item:hover{background: #b30070}.magnet_link_more{color:#555}.magnet_link{color:black}.magnet_link:hover{color:white}@media screen and (max-width: 600px) {.magnet_item {flex-basis: 100%;}}.magnet_link_context{display:flex;padding: 10px;font-size:16px;transition: all 0.2s ease-in-out;}.magnet_link_context:hover{padding: 10px 20px;}</style>
    <style>#catalog_magnet .magnet_item:nth-child(n+7){display:none !important;}</style><script data-pjax="">
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="posts/fa332fd9/" alt=""><img width="48" height="48" src="img/cover/openmanus.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-05-20</span><a class="blog-slider__title" href="posts/fa332fd9/" alt="">OpenManus 核心代码详细分析</a><div class="blog-slider__text">本文档提供了对 OpenManus 项目核心代码文件的深入分析，包括代码结构、算法逻辑、设计思想和实现细节。通过对关键源码的解读，帮助开发者更好地理解 OpenManus 的内部工作机制。</div><a class="blog-slider__button" href="posts/fa332fd9/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="posts/26a8de56/" alt=""><img width="48" height="48" src="img/cover/shark.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2021-04-22</span><a class="blog-slider__title" href="posts/26a8de56/" alt="">Linux中的pushd和popd</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" href="posts/26a8de56/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="posts/d81fecfe/" alt=""><img width="48" height="48" src="img/cover/coffee.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-10-09</span><a class="blog-slider__title" href="posts/d81fecfe/" alt="">如何搞定图床问题 PicGo + 腾讯云COS</a><div class="blog-slider__text">本文介绍如何使用PicGo与腾讯云COS搭建图床，帮助公众号作者高效管理图片，避免手动上传和链接错误。并提供截图，解决权限和链接格式问题，适合发布图文的作者，并解决常见问题。</div><a class="blog-slider__button" href="posts/d81fecfe/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="posts/28d79a75/" alt=""><img width="48" height="48" src="img/cover/line.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2021-04-22</span><a class="blog-slider__title" href="posts/28d79a75/" alt="">Helm Introduction</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" href="posts/28d79a75/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="posts/1b782ceb/" alt=""><img width="48" height="48" src="img/cover/fish.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2021-04-22</span><a class="blog-slider__title" href="posts/1b782ceb/" alt="">23种设计模式的通俗解释</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" href="posts/1b782ceb/" alt="">详情   </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('已挂载butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer="" src="https://cdn.jsdelivr.net/npm/hexo-butterfly-swiper@1.0.12/lib/swiper.min.js"></script><script defer="" data-pjax="" src="https://cdn.jsdelivr.net/npm/hexo-butterfly-swiper@1.0.12/lib/swiper_init.js"></script><!-- hexo injector body_end end --></body></html>